<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iyal | Dynamic Product Sales</title>
    
<script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FAF0E6; /* Linen Cream Background */
            color: #1a1a1a;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-snap-type: y mandatory;
            overflow-y: scroll;
        }

        body.overflow-hidden {
            overflow: hidden !important;
        }

        .snap-section {
            position: relative;
            scroll-snap-align: start;
            scroll-margin-top: 200px; 
        }

        #hero-section, #contact-section {
            height: 100vh;
        }

        #product-slides {
            min-height: 100vh; 
            height: auto; 
            padding-bottom: 15vh;
        }
        
        #hero-section {
            background-color: #4A352D; /* Deep Espresso */
        }

        #product-detail-page, #cart-page, #order-history-page {
            display: none; /* Hidden by default */
            min-height: 100vh;
            padding-top: 100px; /* Offset for fixed header */
        }

        #main-landing-content.hidden-page {
            display: none;
            scroll-snap-type: none; /* Disable snap when hidden */
        }

        .product-card {
            min-height: 450px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .buy-button-style {
            padding: 1rem 2rem;
            font-size: 1.25rem;
            font-weight: bold;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .logo-img {
            height: 40px; 
            width: auto;
            margin-right: 8px; 
        }

        .star-filled {
            color: #FFD700; /* Gold */
        }
        .star-empty {
            color: #cccccc;
        }

        /* Intro animation styles */
        .intro-char {
            display: inline-block;
            opacity: 0;
            transform: translateY(10px); 
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .intro-char.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Loading overlay styles */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #FAF0E6; 
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1.0s ease-out, visibility 1.0s ease-out; 
        }

        .hidden-load {
            opacity: 0;
            visibility: hidden;
        }

        /* Modal specific styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: scale(1);
        }

    </style>
</head>
<body class="overflow-x-hidden">

    

<div id="loading-overlay">
        <div id="iyal-intro-text" class="text-6xl md:text-8xl font-black tracking-widest text-[#4A352D]">
            <span class="intro-char">I</span>
            <span class="intro-char">Y</span>
            <span class="intro-char">A</span>
            <span class="intro-char">L</span>
        </div>
    </div>

    

<header id="main-header" class="fixed top-0 left-0 w-full z-50 p-6 md:p-8 transition-colors duration-500">
        <nav id="main-nav-container" class="flex justify-between items-center max-w-7xl mx-auto">
            
            

<div id="logo-container" class="logo-container flex items-center cursor-pointer" onclick="goHome()">
                <img id="logo-image" 
                     src="https://i.imgur.com/GY15TYP.jpeg" 
                     alt="Iyal Logo" 
                     class="logo-img logo-filter-dark"
                     onerror="this.onerror=null;this.src='https://placehold.co/40x40/4A352D/D4C1B0?text=I';" 
                >
            </div>

            

<div class="flex items-center space-x-4">
                

<button onclick="viewCart()" class="hidden sm:block p-2 rounded-full hover:bg-white/10 transition duration-300 relative">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart" id="cart-icon"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                    

<span id="cart-count" class="absolute top-1 right-1 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                </button>

                

<button id="mobile-menu-toggle" onclick="toggleMobileMenu()" class="p-2 rounded-full hover:bg-white/10 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
            </div>
        </nav>
        <div id="user-info-bar" class="text-xs text-right mt-1 px-4 opacity-80 flex items-center justify-end space-x-2">
            <span id="current-user-status" class="text-white font-medium">...</span>
            <button id="auth-action-button" onclick="showLoginModal()" class="text-white hover:text-[#B38B6D] transition font-bold underline hidden">
                Login / Sign Up
            </button>
            <button id="signout-button" onclick="signOutUser()" class="text-white hover:text-red-400 transition font-bold underline hidden">
                Sign Out
            </button>
        </div>
    </header>

    

<div id="mobile-menu" class="fixed top-0 left-0 w-full h-full bg-[#4A352D] z-[100] transform translate-x-full transition-transform duration-500 overflow-y-auto">
        
        

<div class="flex justify-end p-8">
            <button onclick="toggleMobileMenu()" class="p-2 rounded-full text-white hover:bg-white/10 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        

<nav class="flex flex-col items-center space-y-8 mt-12 text-3xl font-extrabold text-white">
            <a onclick="goHomeAndScroll(0)" class="hover:text-[#B38B6D] transition cursor-pointer">Home</a>
            <a onclick="goHomeAndScroll(1)" class="hover:text-[#B38B6D] transition cursor-pointer">Products</a>
            <a onclick="goHomeAndScroll(2)" class="hover:text-[#B38B6D] transition cursor-pointer">Contact Us</a>
            
            <a onclick="viewCart()" class="hover:text-[#B38B6D] transition cursor-pointer flex items-center space-x-2">
                <span>Cart</span>
                <span id="mobile-cart-count" class="bg-red-600 text-white text-base font-bold rounded-full h-6 w-6 flex items-center justify-center">0</span>
            </a>
            

<a onclick="viewOrderHistory()" class="hover:text-[#B38B6D] transition cursor-pointer">Order History</a>

            <div class="w-2/3 max-w-sm h-px bg-[#B38B6D] my-6 opacity-50"></div>

            <button onclick="handleMobileAuthAction()" class="text-3xl px-10 py-4 rounded-full bg-[#B38B6D] text-white shadow-xl hover:bg-[#9E785C] transition transform hover:scale-105 font-bold">
                <span id="mobile-auth-text">Login / Sign Up</span>
            </button>
        </nav>
    </div>

    

<div id="main-landing-content">
        

<section id="hero-section" class="snap-section bg-[#4A352D] flex items-center justify-center text-center">
            <div id="hero-content" class="w-full flex flex-col items-center justify-center p-8 md:p-16 z-30 max-w-7xl mx-auto">
                <div class="flex flex-col items-center justify-center w-full">
                    <h1 id="hero-title" class="text-6xl md:text-9xl font-extrabold text-white mb-6 uppercase tracking-tighter" style="text-shadow: 0 4px 10px rgba(0,0,0,0.5);">
                        IYAL
                    </h1>
                    <p id="hero-subtitle" class="text-xl md:text-3xl text-white opacity-80 mb-10 font-light" style="text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);">
                        Nourish. Revitalize. Shine.
                    </p>
                </div>
                <a onclick="scrollToSection(1)" class="explore-button bg-[#B38B6D] text-white px-8 py-4 rounded-full text-lg font-semibold shadow-2xl hover:bg-[#9E785C] transition duration-300 transform hover:scale-105 w-max cursor-pointer">
                    Explore Our Products
                </a>
            </div>
        </section>

        

<section id="product-slides" class="snap-section bg-[#FAF0E6] px-4 md:px-12">
            <div class="max-w-7xl mx-auto flex flex-col pt-16 pb-12">
                <h2 class="text-5xl md:text-7xl font-bold text-center mb-16 text-[#4A352D]" id="product-title">
                    Our Premium Lineup
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
                    

<div class="product-card bg-white p-6 rounded-xl shadow-lg border border-[#B38B6D]/30">
                        <div class="h-48 mb-6 flex-shrink-0 flex justify-center items-center bg-[#FDFBF9] rounded-lg overflow-hidden">
                            <img src="https://placehold.co/400x400/8B4513/ffffff?text=Magic+Oil" alt="Hair Oil Bottle" class="w-2/3 h-auto object-contain">
                        </div>
                        <h3 class="text-2xl font-semibold mb-2 text-gray-800">1. Magic Hair Oil</h3>
                        <p class="text-gray-600 mb-4 flex-grow">Deeply nourishes scalp and strands, promoting strength and shine from root to tip.</p>
                        
                        <div class="mt-auto flex justify-between items-center pt-4">
                            <div class="text-xl font-bold text-[#4A352D]">₹300</div>
                            <button onclick="viewProduct('oil_magic')" class="px-6 py-2 bg-[#B38B6D] text-white rounded-full font-semibold shadow-md hover:bg-[#9E785C] transition duration-300 transform hover:scale-105">
                                View Details
                            </button>
                        </div>
                    </div>

                    

<div class="product-card bg-white p-6 rounded-xl shadow-lg border border-[#B38B6D]/30">
                        <div class="h-48 mb-6 flex-shrink-0 flex justify-center items-center bg-[#FDFBF9] rounded-lg overflow-hidden">
                            <img src="https://placehold.co/400x400/696969/ffffff?text=Iyal+Face+Pack" alt="Face Pack Jar" class="w-2/3 h-auto object-contain">
                        </div>
                        <h3 class="text-2xl font-semibold mb-2 text-gray-800">2. Iyal Face Pack</h3>
                        <p class="text-gray-600 mb-4 flex-grow">Detoxifies and purifies pores, revealing a brighter, smoother, and more youthful complexion.</p>
                        
                        <div class="mt-auto flex justify-between items-center pt-4">
                            <div class="text-xl font-bold text-[#4A352D]">₹150</div>
                            <button onclick="viewProduct('face_pack')" class="px-6 py-2 bg-[#B38B6D] text-white rounded-full font-semibold shadow-md hover:bg-[#9E785C] transition duration-300 transform hover:scale-105">
                                View Details
                            </button>
                        </div>
                    </div>

                    

<div class="product-card bg-white p-6 rounded-xl shadow-lg border border-[#B38B6D]/30">
                        <div class="h-48 mb-6 flex-shrink-0 flex justify-center items-center bg-[#FDFBF9] rounded-lg overflow-hidden">
                            <img src="https://placehold.co/400x400/9ACD32/ffffff?text=Iyal+Mix" alt="Health Mix Pouch" class="w-2/3 h-auto object-contain">
                        </div>
                        <h3 class="text-2xl font-semibold mb-2 text-gray-800">3. Iyal Health Mix</h3>
                        <p class="text-gray-600 mb-4 flex-grow">A powerful blend of superfoods to boost immunity and energy throughout your busy day.</p>
                        
                        <div class="mt-auto flex justify-between items-center pt-4">
                            <div class="text-xl font-bold text-[#4A352D]">₹350</div>
                            <button onclick="viewProduct('health_mix')" class="px-6 py-2 bg-[#B38B6D] text-white rounded-full font-semibold shadow-md hover:bg-[#9E785C] transition duration-300 transform hover:scale-105">
                                View Details
                            </button>
                        </div>
                    </div>

                    

<div class="product-card bg-white p-6 rounded-xl shadow-lg border border-[#B38B6D]/30">
                        <div class="h-48 mb-6 flex-shrink-0 flex justify-center items-center bg-[#FDFBF9] rounded-lg overflow-hidden">
                            <img src="https://placehold.co/400x400/800000/ffffff?text=Iyal+Oil" alt="Pain Relief Oil Bottle" class="w-2/3 h-auto object-contain">
                        </div>
                        <h3 class="text-2xl font-semibold mb-2 text-gray-800">4. Iyal Pain Relief Oil</h3>
                        <p class="text-gray-600 mb-4 flex-grow">A potent blend of natural extracts formulated to quickly relieve muscle and joint pain.</p>
                        
                        <div class="mt-auto flex justify-between items-center pt-4">
                            <div class="text-xl font-bold text-[#4A352D]">₹175</div>
                            <button onclick="viewProduct('oil_pain')" class="px-6 py-2 bg-[#B38B6D] text-white rounded-full font-semibold shadow-md hover:bg-[#9E785C] transition duration-300 transform hover:scale-105">
                                View Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        

<section id="contact-section" class="snap-section bg-[#4A352D] text-white flex flex-col justify-center items-center p-8">
            <div class="max-w-4xl w-full text-center">
                <p class="text-2xl md:text-3xl mb-8 font-light italic" id="contact-subtitle">
                    Ready to take the next step in your wellness journey?
                </p>
                <h2 class="text-6xl md:text-8xl font-black mb-16 uppercase tracking-tighter" id="contact-title">
                    Get In Touch.
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 text-left">
                    <div>
                        <h3 class="text-2xl font-bold mb-3">Say Hello</h3>
                        <p class="hover:text-[#B38B6D] transition"><a href="mailto:sales@iyal.in">sales@iyal.in</a></p>
                        <p class="hover:text-[#B38B6D] transition"><a href="tel:+919876543210">+91 987-654-3210</a></p>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-3">Follow Us</h3>
                        <p class="hover:text-[#B38B6D] transition"><a href="#">Instagram</a></p>
                        <p class="hover:text-[#B38B6D] transition"><a href="#">Facebook</a></p>
                        <p class="hover:text-[#B38B6D] transition"><a href="#">LinkedIn</a></p>
                    </div>
                </div>
            </div>
            <footer class="mt-20 text-sm opacity-50">
                &copy; 2024 Iyal. All Rights Reserved.
            </footer>
        </section>
    </div>

    

<div id="product-detail-page" class="bg-white px-4 md:px-12 pb-20">
        <div class="max-w-7xl mx-auto pt-8">
            

<button onclick="goHome()" class="flex items-center text-[#4A352D] font-semibold mb-8 hover:text-[#B38B6D] transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Back to Products
            </button>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                

<div class="flex flex-col items-center p-4 bg-[#FDFBF9] rounded-2xl shadow-inner">
                    <img id="detail-image" src="" alt="Product Detail Image" class="w-full max-w-lg rounded-xl h-auto object-contain mb-4">
                    <div class="text-sm text-gray-500 mt-2">Product image display.</div>
                </div>

                

<div class="pt-4">
                    <h1 id="detail-title" class="text-4xl md:text-6xl font-extrabold text-[#4A352D] mb-4">Product Title</h1>
                    <div id="detail-rating-display" class="flex items-center mb-6">
                        

<span class="text-xl text-gray-500 ml-2">(<span id="detail-review-count">0</span> reviews)</span>
                    </div>

                    <p id="detail-price" class="text-5xl font-bold text-black mb-4">₹0.00</p>
                    
                    

<div class="space-y-2 mb-8">
                        <p id="detail-stock" class="text-xl font-semibold"></p>
                        <p id="detail-delivery" class="text-lg text-gray-600">Estimated Delivery: <span class="font-medium text-[#4A352D]"></span></p>
                    </div>

                    

<div class="flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4 mb-12">
                        

<button onclick="addToCart(currentProductId)" class="buy-button-style bg-[#B38B6D] text-white hover:bg-[#9E785C] flex-1">
                            Add to Cart
                        </button>
                        <button onclick="console.log('Buy Now action initiated!')" class="buy-button-style bg-[#4A352D] text-white hover:bg-[#3A2B23] flex-1">
                            Buy Now
                        </button>
                    </div>
                    
                    

<div class="bg-gray-50 p-6 rounded-xl shadow-inner">
                        <h2 class="text-3xl font-semibold mb-3 text-[#4A352D]">Product Description</h2>
                        <p id="detail-description" class="text-gray-700 leading-relaxed"></p>
                    </div>
                </div>
            </div>

            

<div class="mt-16 grid grid-cols-1 lg:grid-cols-3 gap-8">
                

<div class="lg:col-span-1 p-6 bg-[#FAF0E6] rounded-xl shadow-lg">
                    <h2 class="text-3xl font-bold mb-4 text-[#4A352D]">Key Ingredients</h2>
                    <ul id="detail-specs" class="list-disc list-inside space-y-2 text-gray-700">
                        

</ul>
                </div>

                

<div class="lg:col-span-2 space-y-12">
                    

<div>
                        <h2 class="text-3xl font-bold mb-6 text-[#4A352D]">Customer Reviews</h2>
                        <div id="detail-reviews-list" class="space-y-6">
                            

</div>
                    </div>

                    

<div class="p-8 bg-white rounded-xl shadow-2xl border border-[#B38B6D]/50">
                        <h2 class="text-3xl font-bold mb-6 text-[#4A352D]">Write a Review</h2>
                        <form onsubmit="handleReviewSubmit(event)">
                            <div class="mb-4">
                                <label for="review-name" class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                                <input type="text" id="review-name" name="review-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#B38B6D] focus:border-[#B38B6D] transition" required>
                            </div>
                            <div class="mb-4">
                                <label for="review-rating" class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
                                <select id="review-rating" name="review-rating" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#B38B6D] focus:border-[#B38B6D] transition appearance-none" required>
                                    <option value="">Select a rating</option>
                                    <option value="5">⭐⭐⭐⭐⭐ (Excellent)</option>
                                    <option value="4">⭐⭐⭐⭐ (Good)</option>
                                    <option value="3">⭐⭐⭐ (Average)</option>
                                    <option value="2">⭐⭐ (Poor)</option>
                                    <option value="1">⭐ (Terrible)</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label for="review-comment" class="block text-sm font-medium text-gray-700 mb-2">Your Review</label>
                                <textarea id="review-comment" name="review-comment" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#B38B6D] focus:border-[#B38B6D] transition" required></textarea>
                            </div>
                            <button type="submit" class="w-full px-6 py-3 bg-[#4A352D] text-white rounded-full font-semibold shadow-lg hover:bg-[#3A2B23] transition">
                                Submit Review
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

<div id="cart-page" class="bg-white px-4 md:px-12 pb-20">
        <div class="max-w-7xl mx-auto pt-8">
            

<button onclick="goHome()" class="flex items-center text-[#4A352D] font-semibold mb-8 hover:text-[#B38B6D] transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Continue Shopping
            </button>

            <h1 class="text-5xl md:text-7xl font-extrabold text-[#4A352D] mb-12">Your Shopping Cart</h1>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                

<div class="lg:col-span-2 space-y-6" id="cart-items-list">
                    

<div id="cart-empty-message" class="p-8 bg-gray-100 text-gray-600 rounded-xl text-center text-xl font-medium">
                        Your cart is empty! Time to fill it with some IYAL goodness.
                    </div>
                </div>

                

<div class="lg:col-span-1 p-8 bg-[#FAF0E6] rounded-2xl shadow-xl sticky top-28 h-max">
                    <h2 class="text-3xl font-bold text-[#4A352D] mb-6">Order Summary</h2>
                    
                    <div class="space-y-3 border-b border-gray-300 pb-4 mb-4">
                        <div class="flex justify-between text-lg">
                            <span>Subtotal (<span id="summary-item-count">0</span> items)</span>
                            <span id="summary-subtotal" class="font-medium">₹0.00</span>
                        </div>
                        <div class="flex justify-between text-lg">
                            <span>Shipping</span>
                            <span class="font-medium text-green-600">FREE</span>
                        </div>
                        <div class="flex justify-between text-lg text-gray-600">
                            <span>Taxes (18% Mock)</span>
                            <span id="summary-tax" class="font-medium">₹0.00</span>
                        </div>
                    </div>

                    <div class="flex justify-between text-2xl font-bold mb-8">
                        <span>Grand Total</span>
                        <span id="summary-grand-total" class="text-[#4A352D]">₹0.00</span>
                    </div>

                    <button onclick="console.log('Proceeding to Checkout!')" class="w-full buy-button-style bg-[#4A352D] text-white hover:bg-[#3A2B23] text-lg py-3">
                        Proceed to Checkout
                    </button>
                    <p class="text-sm text-center text-gray-500 mt-4">Shipping calculated at checkout.</p>
                </div>
            </div>
        </div>
    </div>

    

<div id="order-history-page" class="bg-white px-4 md:px-12 pb-20">
        <div class="max-w-7xl mx-auto pt-8">
            

<button onclick="goHome()" class="flex items-center text-[#4A352D] font-semibold mb-8 hover:text-[#B38B6D] transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Back to Home
            </button>

            <h1 class="text-5xl md:text-7xl font-extrabold text-[#4A352D] mb-12">Your Order History</h1>
            
            <div id="orders-list-container" class="space-y-8">
                

<div id="order-history-empty-message" class="p-8 bg-gray-100 text-gray-600 rounded-xl text-center text-xl font-medium">
                    You haven't placed any orders yet.
                </div>
            </div>
        </div>
    </div>
    
    
    

<div id="auth-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-end">
                <button onclick="hideLoginModal()" class="text-gray-500 hover:text-gray-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <h2 id="auth-title" class="text-3xl font-bold text-[#4A352D] mb-6 text-center">Login</h2>
            
            <div id="auth-error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4 hidden" role="alert">
                <span id="auth-error-message" class="block sm:inline"></span>
            </div>

            <form id="auth-form" onsubmit="event.preventDefault(); handleAuthSubmit();">
                <div class="mb-4">
                    <label for="auth-email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="auth-email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#B38B6D] focus:border-[#B38B6D] transition" required>
                </div>
                <div class="mb-6">
                    <label for="auth-password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="auth-password" name="password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[#B38B6D] focus:border-[#B38B6D] transition" required minlength="6">
                </div>

                <button type="submit" id="auth-submit-button" class="w-full px-6 py-3 bg-[#4A352D] text-white rounded-full font-semibold shadow-lg hover:bg-[#3A2B23] transition">
                    Login
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button id="auth-toggle-button" onclick="toggleAuthMode()" class="text-[#B38B6D] hover:text-[#4A352D] text-sm font-medium transition">
                    New user? Click here to Sign Up
                </button>
            </div>
        </div>
    </div>


    

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence, 
                 createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, writeBatch, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('debug'); // Enable Firestore logging

        // --- Firebase Global Variables (Provided by environment) ---
        const appId = "iyal-app" ; // **CORRECTED:** Added quotes to make it a string.
        const firebaseConfig = {
          apikey: "AIzaSyA5hPlKdqNi1FmAlVFmIXezZxot9-BuWeA",
          authdomain: "iyal-59a03.firebaseapp.com",
          projectid: "iyal-59a03",
          storageBucket: "iyal-59a03.firebasestorage.app",
          messagingSenderId: "714618123459",
          appId: "1:714618123459:web:ae86588468119322bd1e76",
          measurementId: "G-0GZSM3CDME"
        }; // **CORRECTED:** Replaced colon (:) with a semicolon (;).
        const initialAuthToken = null;

        let db, auth, userId = null;
        let isAuthReady = false;
        let cartItems = []; // Local array to hold cart items synchronized with Firestore
        let currentProductId = null; // Tracks the currently viewed product ID
        let authMode = 'login'; // 'login' or 'signup'
        let currentUser = null; // Holds the Firebase User object

        // --- Product Data Mock API (Same as before) ---
        const PRODUCTS = {
            'oil_magic': { id: 'oil_magic', name: 'Magic Hair Oil', price: 300, stock: 120, avgRating: 4.8, reviews: 45, delivery: '3-5 business days', image: 'https://placehold.co/600x600/8B4513/ffffff?text=Magic+Oil', description: "Iyal's Magic Hair Oil is a potent, time-tested blend of 12 natural herbs, cold-pressed with virgin coconut oil...", specs: ['Virgin Coconut Oil Base', 'Amla (Indian Gooseberry)', 'Bhringraj (False Daisy)', 'Hibiscus Flower Extracts', 'No Artificial Scents or Colors'], mockReviews: [{ name: 'Priya S.', rating: 5, comment: 'Absolutely transformed my hair!' }, { name: 'Ravi M.', rating: 4, comment: 'Great product, but the earthy smell is quite strong.' }] },
            'face_pack': { id: 'face_pack', name: 'Iyal Face Pack', price: 150, stock: 0, avgRating: 4.2, reviews: 22, delivery: 'Currently unavailable', image: 'https://placehold.co/600x600/696969/ffffff?text=Iyal+Face+Pack', description: "This purifying face pack is made with volcanic clay and activated charcoal to draw out deep-seated impurities...", specs: ['Volcanic Clay', 'Activated Charcoal', 'Pure Sandalwood Powder', 'Rose Water', 'Suitable for All Skin Types'], mockReviews: [{ name: 'Kavya T.', rating: 5, comment: 'My favorite! Gives a spa-like glow instantly.' }, { name: 'Arun V.', rating: 3, comment: 'A little drying on my combination skin.' }] },
            'health_mix': { id: 'health_mix', name: 'Iyal Health Mix', price: 350, stock: 450, avgRating: 4.9, reviews: 78, delivery: '2-4 business days', image: 'https://placehold.co/600x600/9ACD32/ffffff?text=Iyal+Mix', description: "A nutritious powerhouse, this daily health mix is a blend of 18 roasted grains, pulses, and nuts...", specs: ['Multi-Grain Blend (Ragi, Bajra, Wheat)', 'Pulses (Moong, Chana)', 'Dry Fruits (Almonds, Cashews)', 'No Added Sugar', 'High in Dietary Fiber'], mockReviews: [{ name: 'Deepak J.', rating: 5, comment: 'Perfect start to my day.' }, { name: 'Shreya P.', rating: 5, comment: 'My kids love this mixed with jaggery.' }] },
            'oil_pain': { id: 'oil_pain', name: 'Iyal Pain Relief Oil', price: 175, stock: 250, avgRating: 4.5, reviews: 31, delivery: '4-6 business days', image: 'https://placehold.co/600x600/800000/ffffff?text=Iyal+Oil', description: "Experience fast, deep relief from muscle aches, joint stiffness, and chronic pain. Our Pain Relief Oil uses traditional ayurvedic wisdom...", specs: ['Sesame Oil Base', 'Wintergreen Oil', 'Eucalyptus Oil', 'Camphor', 'Rapid Penetration Formula'], mockReviews: [{ name: 'Vimal K.', rating: 4, comment: 'Very effective for my knee pain after running.' }, { name: 'Leena R.', rating: 5, comment: 'Best pain relief oil I have ever used.' }] }
        };

        const mockOrders = [
            { id: 'ORD4008', date: '2025-10-01', total: 680.00, status: 'Delivered', 
                items: [{ name: 'Magic Hair Oil', price: 300, quantity: 1 }, { name: 'Iyal Pain Relief Oil', price: 175, quantity: 2 }] 
            },
            { id: 'ORD4007', date: '2025-08-15', total: 350.00, status: 'Shipped', 
                items: [{ name: 'Iyal Health Mix', price: 350, quantity: 1 }] 
            },
            { id: 'ORD4006', date: '2025-07-20', total: 900.00, status: 'Processing', 
                items: [{ name: 'Magic Hair Oil', price: 300, quantity: 3 }] 
            }
        ];


        // --- DOM Elements ---
        const mainHeader = document.getElementById('main-header');
        const mainLandingContent = document.getElementById('main-landing-content');
        const productDetailPage = document.getElementById('product-detail-page');
        const cartPage = document.getElementById('cart-page');
        const orderHistoryPage = document.getElementById('order-history-page'); 

        const cartItemsListElement = document.getElementById('cart-items-list');
        const cartCountDesktop = document.getElementById('cart-count');
        const cartCountMobile = document.getElementById('mobile-cart-count');
        
        const authModal = document.getElementById('auth-modal');
        const authTitle = document.getElementById('auth-title');
        const authSubmitButton = document.getElementById('auth-submit-button');
        const authToggleButton = document.getElementById('auth-toggle-button');
        const authError = document.getElementById('auth-error');
        const authErrorMessage = document.getElementById('auth-error-message');
        const userStatusElement = document.getElementById('current-user-status');
        const authActionButton = document.getElementById('auth-action-button');
        const signoutButton = document.getElementById('signout-button');
        const mobileAuthText = document.getElementById('mobile-auth-text');
        const ordersListContainer = document.getElementById('orders-list-container');
        const orderHistoryEmptyMessage = document.getElementById('order-history-empty-message');


        // --- FIREBASE INITIALIZATION AND AUTH ---
        async function setupFirebaseAndAuth() {
            if (!firebaseConfig) {
                console.error("Firebase config not found.");
                userStatusElement.textContent = 'Firebase Error: Config Missing';
                return;
            }

            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            try {
                // Set persistence to local to remember the session
                await setPersistence(auth, browserLocalPersistence);
                
                // Sign in with custom token if available, otherwise anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Main Auth State Listener
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        
                        // Update UI based on user type
                        if (user.email) {
                            // Email/Password User (potentially unverified)
                            if (user.emailVerified) {
                                userStatusElement.innerHTML = `Signed in as: <span class="font-bold text-green-300">${user.email}</span>`;
                                authActionButton.classList.add('hidden');
                                signoutButton.classList.remove('hidden');
                                mobileAuthText.textContent = 'Sign Out';
                            } else {
                                // Email/Password User - Unverified
                                userStatusElement.innerHTML = `Email: ${user.email} (<span class="text-red-400 font-bold">Unverified</span>)`;
                                authActionButton.textContent = 'Resend Verification';
                                authActionButton.onclick = sendVerificationEmail;
                                authActionButton.classList.remove('hidden');
                                signoutButton.classList.remove('hidden');
                                mobileAuthText.textContent = 'Sign Out';
                            }
                        } else {
                            // Anonymous or Token User
                            userStatusElement.innerHTML = `Guest User ID: <span class="font-bold">${user.uid.substring(0, 8)}...</span>`;
                            authActionButton.textContent = 'Login / Sign Up';
                            authActionButton.onclick = showLoginModal;
                            authActionButton.classList.remove('hidden');
                            signoutButton.classList.add('hidden'); // Cannot sign out anon user authenticated via token
                            mobileAuthText.textContent = 'Login / Sign Up';
                        }
                        
                        listenToCart(); 
                    } else {
                        // Signed out
                        userId = null;
                        isAuthReady = false;
                        userStatusElement.textContent = 'Signed Out.';
                        authActionButton.textContent = 'Login / Sign Up';
                        authActionButton.onclick = showLoginModal;
                        authActionButton.classList.remove('hidden');
                        signoutButton.classList.add('hidden');
                        mobileAuthText.textContent = 'Login / Sign Up';
                        cartItems = [];
                        updateCartUI();
                    }
                });

            } catch (error) {
                console.error("Firebase Auth or Init error:", error);
                userStatusElement.textContent = `Auth Error: ${error.code}`;
            }
        }

        /**
         * Sends the verification email to the current user.
         */
        async function sendVerificationEmail() {
            if (!currentUser) return;
            try {
                await sendEmailVerification(currentUser);
                // NOTE: Using a custom alert instead of window.alert()
                console.log("Verification email successfully sent.");
                document.getElementById('auth-error-message').textContent = "Verification email sent! Please check your inbox and spam folder.";
                document.getElementById('auth-error').classList.remove('hidden');
                setTimeout(() => document.getElementById('auth-error').classList.add('hidden'), 5000);
            } catch (error) {
                console.error("Error sending verification email:", error);
                document.getElementById('auth-error-message').textContent = `Error sending verification email: ${error.message}. Please try again later.`;
                document.getElementById('auth-error').classList.remove('hidden');
            }
        }
        
        /**
         * Signs out the currently authenticated user.
         */
        async function signOutUser() {
            try {
                await signOut(auth);
                console.log("User signed out successfully.");
                goHome();
                // NOTE: The onAuthStateChanged listener handles the UI update
            } catch (error) {
                console.error("Error signing out:", error);
                document.getElementById('auth-error-message').textContent = `Sign out failed: ${error.message}`;
                document.getElementById('auth-error').classList.remove('hidden');
            }
        }

        // --- AUTH MODAL LOGIC ---
        
        function showLoginModal() {
            authModal.style.display = 'flex';
            authModal.classList.add('active');
            // Hide any previous error messages
            authError.classList.add('hidden');
            document.getElementById('auth-form').reset();
            toggleAuthMode('login'); // Default to login when showing
            toggleMobileMenu(true); // Close mobile menu if open
        }

        function hideLoginModal() {
            authModal.classList.remove('active');
            setTimeout(() => { authModal.style.display = 'none'; }, 300); // Wait for transition
        }

        function toggleAuthMode(mode) {
            authMode = mode || (authMode === 'login' ? 'signup' : 'login');
            
            if (authMode === 'login') {
                authTitle.textContent = 'Login';
                authSubmitButton.textContent = 'Login';
                authToggleButton.innerHTML = 'New user? Click here to **Sign Up**';
            } else {
                authTitle.textContent = 'Sign Up';
                authSubmitButton.textContent = 'Sign Up';
                authToggleButton.innerHTML = 'Already have an account? Click here to **Login**';
            }
        }

        async function handleAuthSubmit() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            authError.classList.add('hidden');
            authErrorMessage.textContent = '';
            
            try {
                if (authMode === 'signup') {
                    // 1. Create the user
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    // 2. Send verification email
                    await sendEmailVerification(user);
                    
                    // Display success message in the modal before closing
                    authErrorMessage.textContent = `Signup successful! A verification email has been sent to ${email}. Please verify your email to fully activate your account.`;
                    authError.classList.remove('hidden');
                    
                    // Wait a moment then close the modal
                    setTimeout(() => {
                        hideLoginModal();
                        // Firebase will automatically sign in the user after signup.
                    }, 3000); 

                } else {
                    // Login
                    await signInWithEmailAndPassword(auth, email, password);
                    hideLoginModal();
                }
            } catch (error) {
                console.error("Authentication Error:", error);
                authErrorMessage.textContent = getAuthErrorMessage(error.code);
                authError.classList.remove('hidden');
            }
        }
        
        function getAuthErrorMessage(code) {
            switch (code) {
                // This is the specific fix/feedback for the user's issue
                case 'auth/operation-not-allowed':
                    return 'Sign up/login failed. The **Email/Password sign-in method** is currently **disabled** in your Firebase Console. Please **enable it** under Authentication -> Sign-in method.';
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                    return 'Invalid email or password.';
                case 'auth/email-already-in-use':
                    return 'This email is already in use. Try logging in.';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters.';
                case 'auth/invalid-email':
                    return 'The email address is not valid.';
                case 'auth/too-many-requests':
                    return 'Access to this account has been temporarily blocked due to too many failed login attempts. Please try again later.';
                default:
                    return `An unknown error occurred: ${code}`;
            }
        }

        function handleMobileAuthAction() {
            toggleMobileMenu(true);
            if (currentUser && currentUser.email) {
                // If logged in via email, mobile button is for sign out
                signOutUser();
            } else {
                // If guest/token user, mobile button is for login/signup
                showLoginModal();
            }
        }


        // --- Firestore/Cart Functions ---

        function getCartCollectionRef() {
            if (!db || !userId) {
                console.error("Database or User ID not ready.");
                return null;
            }
            return collection(db, `artifacts/${appId}/users/${userId}/cart_items`);
        }
        
        function getOrdersCollectionRef() {
            if (!db || !userId) {
                console.error("Database or User ID not ready.");
                return null;
            }
            return collection(db, `artifacts/${appId}/users/${userId}/orders`);
        }

        function listenToCart() {
            const cartRef = getCartCollectionRef();
            if (!cartRef) return;

            onSnapshot(cartRef, (snapshot) => {
                const newCartItems = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const productDetails = PRODUCTS[data.productId];
                    if (productDetails) {
                        newCartItems.push({
                            id: doc.id, 
                            ...data,
                            ...productDetails
                        });
                    }
                });
                cartItems = newCartItems;
                updateCartUI();
                renderCartPage();
            }, (error) => {
                console.error("Error listening to cart changes:", error);
            });
        }

        function updateCartUI() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            cartCountDesktop.textContent = totalItems;
            cartCountMobile.textContent = totalItems;

            if (totalItems > 0) {
                cartCountDesktop.classList.remove('hidden');
            } else {
                cartCountDesktop.classList.add('hidden');
            }
        }

        async function addToCart(productId) {
            // Check if user is verified before allowing adding to cart
            if (!currentUser || (currentUser.email && !currentUser.emailVerified)) {
                // Display error feedback on the screen instead of using alert
                document.getElementById('auth-error-message').textContent = "Please log in and verify your email address to add items to your cart.";
                document.getElementById('auth-error').classList.remove('hidden');
                showLoginModal();
                return;
            }
            
            if (!isAuthReady) {
                console.error("Authentication not ready. Cannot add to cart.");
                return;
            }

            const product = PRODUCTS[productId];
            if (!product || product.stock <= 0) {
                console.warn(`Product ${productId} is out of stock.`);
                return;
            }
            
            const existingItem = cartItems.find(item => item.productId === productId);
            const cartRef = getCartCollectionRef();

            try {
                if (existingItem) {
                    const itemDocRef = doc(cartRef, existingItem.id);
                    await updateDoc(itemDocRef, {
                        quantity: existingItem.quantity + 1,
                        updatedAt: new Date().toISOString()
                    });
                } else {
                    await addDoc(cartRef, {
                        productId: productId,
                        quantity: 1,
                        addedAt: new Date().toISOString()
                    });
                }
                
                const detailButton = document.querySelector(`#product-detail-page button[onclick="addToCart('${productId}')"]`);
                showTemporaryFeedback(detailButton, 'Added to Cart!', 'bg-green-600');

            } catch (e) {
                console.error("Error adding/updating cart item:", e);
                const detailButton = document.querySelector(`#product-detail-page button[onclick="addToCart('${productId}')"]`);
                showTemporaryFeedback(detailButton, 'Error!', 'bg-red-600');
            }
        }
        
        async function removeItem(cartItemId) {
            if (!isAuthReady) return;
            const cartRef = getCartCollectionRef();
            const itemDocRef = doc(cartRef, cartItemId);
            try { await deleteDoc(itemDocRef); } catch (e) { console.error("Error removing cart item:", e); }
        }

        async function updateQuantity(cartItemId, newQuantity) {
            if (!isAuthReady) return;
            const quantity = parseInt(newQuantity);
            if (quantity < 1 || isNaN(quantity)) { return removeItem(cartItemId); }
            const cartRef = getCartCollectionRef();
            const itemDocRef = doc(cartRef, cartItemId);
            try {
                await updateDoc(itemDocRef, { quantity: quantity, updatedAt: new Date().toISOString() });
            } catch (e) { console.error("Error updating quantity:", e); }
        }

        // --- Navigation and UI State ---
        
        function renderCartPage() { 
            if (!isAuthReady || !cartItemsListElement) return;
            let totalItems = 0; let subtotal = 0;
            const cartEmptyMessage = document.getElementById('cart-empty-message');
            if (cartItems.length === 0) { 
                cartEmptyMessage.style.display = 'block'; 
                cartItemsListElement.innerHTML = ''; 
            } else { 
                cartEmptyMessage.style.display = 'none';
                cartItemsListElement.innerHTML = cartItems.map(item => {
                    const itemTotal = item.price * item.quantity; subtotal += itemTotal; totalItems += item.quantity;
                    return `<div class="flex flex-col sm:flex-row items-start sm:items-center p-4 bg-white rounded-xl shadow-md border border-gray-200"><img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-contain rounded-lg flex-shrink-0 mr-4 border border-gray-100"><div class="flex-grow my-2 sm:my-0"><h3 class="text-xl font-semibold text-[#4A352D]">${item.name}</h3><p class="text-gray-500">Price: ₹${item.price.toFixed(2)}</p></div><div class="flex items-center space-x-4 mt-3 sm:mt-0 sm:ml-auto"><div class="flex items-center border border-gray-300 rounded-full overflow-hidden"><button onclick="updateQuantity('${item.id}', ${item.quantity - 1})" class="p-2 w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-lg font-bold transition rounded-l-full">&minus;</button><input type="number" value="${item.quantity}" min="1" onchange="updateQuantity('${item.id}', this.value)" class="w-12 text-center text-lg border-x border-gray-300 focus:outline-none focus:ring-0 appearance-none bg-white"><button onclick="updateQuantity('${item.id}', ${item.quantity + 1})" class="p-2 w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-lg font-bold transition rounded-r-full">&#43;</button></div><div class="text-xl font-bold w-24 text-right">₹${itemTotal.toFixed(2)}</div><button onclick="removeItem('${item.id}')" class="text-red-500 hover:text-red-700 transition p-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></button></div></div>`;
                }).join('');
            }
            const taxRate = 0.18; 
            const taxAmount = subtotal * taxRate; 
            const grandTotal = subtotal + taxAmount;
            document.getElementById('summary-item-count').textContent = totalItems; 
            document.getElementById('summary-subtotal').textContent = `₹${subtotal.toFixed(2)}`;
            document.getElementById('summary-tax').textContent = `₹${taxAmount.toFixed(2)}`; 
            document.getElementById('summary-grand-total').textContent = `₹${grandTotal.toFixed(2)}`;
        }
        
        function renderOrderHistoryPage() {
            if (!ordersListContainer) return;
            if (mockOrders.length === 0) { 
                orderHistoryEmptyMessage.style.display = 'block'; 
                ordersListContainer.innerHTML = ''; 
                return; 
            }
            orderHistoryEmptyMessage.style.display = 'none';
            ordersListContainer.innerHTML = mockOrders.map(order => {
                let statusColor = 'text-gray-600'; 
                if (order.status === 'Delivered') statusColor = 'text-green-600 font-semibold'; 
                if (order.status === 'Shipped') statusColor = 'text-yellow-600 font-semibold'; 
                if (order.status === 'Processing') statusColor = 'text-blue-600 font-semibold';
                const itemsList = order.items.map(item => `<div class="flex justify-between text-sm text-gray-500 ml-4"><span>${item.quantity} x ${item.name}</span><span>₹${(item.price * item.quantity).toFixed(2)}</span></div>`).join('');
                return `<div class="bg-white p-6 rounded-xl shadow-lg border border-[#B38B6D]/30 transition hover:shadow-xl"><div class="flex justify-between items-start pb-4 border-b border-gray-200 mb-4 flex-wrap"><div><h3 class="text-xl md:text-2xl font-bold text-[#4A352D]">Order ID: ${order.id}</h3><p class="text-sm text-gray-500">Placed on: ${order.date}</p></div><div class="mt-2 md:mt-0 text-right"><p class="text-2xl font-bold text-black">₹${order.total.toFixed(2)}</p><p class="text-sm ${statusColor}">Status: ${order.status}</p></div></div><div class="space-y-2"><h4 class="text-lg font-semibold text-gray-700">Items Ordered:</h4>${itemsList}</div><div class="mt-6 pt-4 border-t border-gray-100 flex justify-end space-x-4"><button onclick="console.log('Tracking Order ${order.id}')" class="px-4 py-2 text-[#4A352D] border border-[#4A352D] rounded-full text-sm font-semibold hover:bg-[#4A352D] hover:text-white transition">Track Order</button><button onclick="console.log('Reordering Order ${order.id}')" class="px-4 py-2 bg-[#B38B6D] text-white rounded-full text-sm font-semibold hover:bg-[#9E785C] transition">Reorder</button></div></div>`;
            }).join('');
        }
        
        function viewCart() { 
            productDetailPage.style.display = 'none'; 
            orderHistoryPage.style.display = 'none'; 
            mainLandingContent.classList.add('hidden-page'); 
            cartPage.style.display = 'block'; 
            window.scrollTo(0, 0); 
            handleScroll(true); 
            toggleMobileMenu(true); 
        }
        
        function viewOrderHistory() { 
            productDetailPage.style.display = 'none'; 
            cartPage.style.display = 'none'; 
            mainLandingContent.classList.add('hidden-page'); 
            orderHistoryPage.style.display = 'block'; 
            renderOrderHistoryPage(); 
            window.scrollTo(0, 0); 
            handleScroll(true); 
            toggleMobileMenu(true); 
        }
        
        function viewProduct(productId) { 
            currentProductId = productId; 
            const product = PRODUCTS[productId]; 
            if (!product) { 
                console.error(`Product with ID ${productId} not found.`); 
                return; 
            }
            document.getElementById('detail-title').textContent = product.name; 
            document.getElementById('detail-image').src = product.image; 
            document.getElementById('detail-image').alt = product.name + " Image"; 
            document.getElementById('detail-description').textContent = product.description; 
            document.getElementById('detail-price').textContent = `₹${product.price.toFixed(2)}`;
            
            const stockElement = document.getElementById('detail-stock'); 
            const deliveryElement = document.getElementById('detail-delivery').querySelector('span'); 
            const buyButtons = productDetailPage.querySelectorAll('.buy-button-style');
            
            if (product.stock > 0) { 
                stockElement.innerHTML = `<span class="text-green-600">&#10003; In Stock!</span> (${product.stock} left)`; 
                deliveryElement.textContent = product.delivery; 
                buyButtons.forEach(btn => btn.disabled = false); 
                buyButtons.forEach(btn => btn.classList.remove('opacity-50', 'cursor-not-allowed')); 
            } else { 
                stockElement.innerHTML = `<span class="text-red-600">&#10007; Out of Stock</span>`; 
                deliveryElement.textContent = 'Currently unavailable for delivery.'; 
                buyButtons.forEach(btn => btn.disabled = true); 
                buyButtons.forEach(btn => btn.classList.add('opacity-50', 'cursor-not-allowed')); 
            }
            
            const specsList = document.getElementById('detail-specs'); 
            // The next line splits the rating display to keep the count span intact.
            document.getElementById('detail-rating-display').innerHTML = renderStars(product.avgRating) + document.getElementById('detail-rating-display').innerHTML.split(')')[1];
            
            specsList.innerHTML = product.specs.map(item => `<li>${item}</li>`).join(''); 
            document.getElementById('detail-review-count').textContent = product.reviews; 
             
            const reviewsList = document.getElementById('detail-reviews-list'); 
            reviewsList.innerHTML = product.mockReviews.map(review => `<div class="border-b border-gray-200 pb-4"><div class="flex items-center mb-1">${renderStars(review.rating)}<span class="ml-4 font-semibold text-lg">${review.name}</span></div><p class="text-gray-600 italic">"${review.comment}"</p></div>`).join('');
            
            mainLandingContent.classList.add('hidden-page'); 
            cartPage.style.display = 'none'; 
            orderHistoryPage.style.display = 'none'; 
            productDetailPage.style.display = 'block'; 
            window.scrollTo(0, 0); 
            mainHeader.classList.add('bg-[#4A352D]', 'shadow-md');
        }
        
        function goHome() { 
            productDetailPage.style.display = 'none';
            cartPage.style.display = 'none';
            orderHistoryPage.style.display = 'none'; 
            mainLandingContent.classList.remove('hidden-page');
            window.scrollTo(0, 0); 
            handleScroll(); 
        }
        
        function goHomeAndScroll(sectionIndex) { 
            productDetailPage.style.display = 'none';
            cartPage.style.display = 'none';
            orderHistoryPage.style.display = 'none'; 
            mainLandingContent.classList.remove('hidden-page');
            scrollToSection(sectionIndex);
            setTimeout(() => toggleMobileMenu(true), 300); // Pass true to force close
            handleScroll();
        }
        
        function handleScroll(forceDark = false) {
            if (mainLandingContent.classList.contains('hidden-page') && !forceDark) {
                mainHeader.classList.add('bg-[#4A352D]', 'shadow-md'); document.querySelectorAll('#cart-icon, #mobile-menu-toggle svg').forEach(el => el.setAttribute('stroke', 'white')); return;
            }
            const scrollY = window.scrollY; const viewportHeight = window.innerHeight;
            const isScrolledToProductSection = scrollY >= (viewportHeight * 0.5);
            if (isScrolledToProductSection) {
                mainHeader.classList.add('bg-[#4A352D]', 'shadow-md'); document.querySelectorAll('#cart-icon, #mobile-menu-toggle svg').forEach(el => el.setAttribute('stroke', 'white'));
            } else {
                mainHeader.classList.remove('bg-[#4A352D]', 'shadow-md'); document.querySelectorAll('#cart-icon, #mobile-menu-toggle svg').forEach(el => el.setAttribute('stroke', 'white'));
            }
        }
        
        function renderStars(rating) {
            let starsHtml = ''; 
            const fullStars = Math.floor(rating); 
            const halfStar = rating % 1 !== 0; 
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            for (let i = 0; i < fullStars; i++) { starsHtml += `<span class="star-filled text-2xl">&#9733;</span>`; }
            if (halfStar) { starsHtml += `<span class="star-filled text-2xl">&#9733;</span>`; }
            for (let i = 0; i < emptyStars; i++) { starsHtml += `<span class="star-empty text-2xl">&#9733;</span>`; }
            
            starsHtml += `<span class="text-xl font-bold ml-3 text-[#4A352D]">${rating.toFixed(1)}</span>`;
            return starsHtml;
        }

        // --- Scrolling & Animation Utilities ---
        function easeInOutQuint(t) { return t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * (--t) * t * t * t * t; }
        
        function animateScroll(targetY, duration) {
            const startY = window.scrollY;
            const distance = targetY - startY;
            let startTime = null;

            function step(currentTime) {
                if (startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const progress = Math.min(timeElapsed / duration, 1);
                const easedProgress = easeInOutQuint(progress);

                window.scrollTo(0, startY + distance * easedProgress);

                if (timeElapsed < duration) {
                    window.requestAnimationFrame(step);
                }
            }
            window.requestAnimationFrame(step);
        }

        function scrollToSection(sectionIndex) {
            const sections = document.querySelectorAll('.snap-section');
            if (sections[sectionIndex]) {
                const targetY = sections[sectionIndex].offsetTop;
                animateScroll(targetY, 800);
            }
        }
        
        function toggleMobileMenu(forceClose = false) {
            const mobileMenu = document.getElementById('mobile-menu');
            const isMenuOpen = !mobileMenu.classList.contains('translate-x-full');
            if (isMenuOpen || forceClose) { 
                mobileMenu.classList.add('translate-x-full'); 
                document.body.classList.remove('overflow-hidden'); 
            } else { 
                mobileMenu.classList.remove('translate-x-full'); 
                document.body.classList.add('overflow-hidden'); 
            }
        }
        
        function showTemporaryFeedback(button, text, className) {
            const originalText = button.textContent; 
            const originalClasses = button.className;
            button.textContent = text; 
            button.className = `${originalClasses.replace(/bg-\[\#\w+\]/, className)}`;
            
            setTimeout(() => { 
                button.textContent = originalText; 
                button.className = originalClasses; 
            }, 2000);
        }
        
        function handleReviewSubmit(event) {
            event.preventDefault(); 
            console.log(`Review submitted by: ${document.getElementById('review-name').value}`);
            const submitButton = event.target.querySelector('button[type="submit"]'); 
            showTemporaryFeedback(submitButton, 'Review Submitted!', 'bg-green-600'); 
            event.target.reset();
        }


        // Exposed Global Functions
        window.goHome = goHome;
        window.viewProduct = viewProduct;
        window.viewCart = viewCart;
        window.viewOrderHistory = viewOrderHistory;
        window.goHomeAndScroll = goHomeAndScroll;
        window.toggleMobileMenu = toggleMobileMenu;
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.removeItem = removeItem;
        window.handleReviewSubmit = handleReviewSubmit;
        window.scrollToSection = scrollToSection;
        window.showLoginModal = showLoginModal; 
        window.hideLoginModal = hideLoginModal; 
        window.toggleAuthMode = toggleAuthMode; 
        window.handleAuthSubmit = handleAuthSubmit; 
        window.signOutUser = signOutUser; 
        window.sendVerificationEmail = sendVerificationEmail; 
        window.handleMobileAuthAction = handleMobileAuthAction; 

        // --- Initialization ---

        window.onload = () => {
            setupFirebaseAndAuth();

            // Loading Overlay animation
            const loadingOverlay = document.getElementById('loading-overlay');
            const iyalTextContainer = document.getElementById('iyal-intro-text');
            const chars = iyalTextContainer.querySelectorAll('.intro-char');
            const staggerDelay = 200; 
            let totalRevealTime = chars.length * staggerDelay; 
            
            chars.forEach((char, index) => {
                setTimeout(() => {
                    char.classList.add('visible');
                }, index * staggerDelay);
            });
            
            setTimeout(() => {
                loadingOverlay.classList.add('hidden-load');
            }, totalRevealTime + 200); 
            
            // Attach Listeners
            window.addEventListener('scroll', () => handleScroll());
            handleScroll(); // Initial check
        };
        
    </script>
</body>
</html>
